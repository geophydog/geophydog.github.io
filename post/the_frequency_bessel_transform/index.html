<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>The frequency-Bessel (F-J) transform for estimating multimodal surface wave dispersion curves: synthetic experiments and field applications - Geophydog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Geophydog" /><meta name="description" content="1. Background Passive dense array surface wave tomography plays a significant role in probing the earth&amp;rsquo;s interior with the development of a large number of dense seismic arrays, attracting researchers&amp;rsquo; growing interest in imaging applications in various scales. These array methods, like beamforming and MASW (multichannel analysis of surface wave) have been widely used to estimate dispersion curves in past several decades. A new array stacking technique, the frequency-Bessel (F-J) transform, was proposed about five years ago with some main advantages of extracting dispersion curves of high-resolution and broad frequency band (Wang et al." /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.74.3 with theme even" />


<link rel="canonical" href="https://geophydog.cool/post/the_frequency_bessel_transform/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.8452f0d62dad176c854eaf1ef7eb3cdfa7651088d7f411fdc99c5c3efb76bf90.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="The frequency-Bessel (F-J) transform for estimating multimodal surface wave dispersion curves: synthetic experiments and field applications" />
<meta property="og:description" content="1. Background Passive dense array surface wave tomography plays a significant role in probing the earth&rsquo;s interior with the development of a large number of dense seismic arrays, attracting researchers&rsquo; growing interest in imaging applications in various scales. These array methods, like beamforming and MASW (multichannel analysis of surface wave) have been widely used to estimate dispersion curves in past several decades. A new array stacking technique, the frequency-Bessel (F-J) transform, was proposed about five years ago with some main advantages of extracting dispersion curves of high-resolution and broad frequency band (Wang et al." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://geophydog.cool/post/the_frequency_bessel_transform/" />
<meta property="article:published_time" content="2024-01-29T17:51:29+08:00" />
<meta property="article:modified_time" content="2024-01-29T17:51:29+08:00" />
<meta itemprop="name" content="The frequency-Bessel (F-J) transform for estimating multimodal surface wave dispersion curves: synthetic experiments and field applications">
<meta itemprop="description" content="1. Background Passive dense array surface wave tomography plays a significant role in probing the earth&rsquo;s interior with the development of a large number of dense seismic arrays, attracting researchers&rsquo; growing interest in imaging applications in various scales. These array methods, like beamforming and MASW (multichannel analysis of surface wave) have been widely used to estimate dispersion curves in past several decades. A new array stacking technique, the frequency-Bessel (F-J) transform, was proposed about five years ago with some main advantages of extracting dispersion curves of high-resolution and broad frequency band (Wang et al.">
<meta itemprop="datePublished" content="2024-01-29T17:51:29+08:00" />
<meta itemprop="dateModified" content="2024-01-29T17:51:29+08:00" />
<meta itemprop="wordCount" content="3556">



<meta itemprop="keywords" content="surface wave,array processing,dispersion curve,frequency-Bessel transform,F-J," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The frequency-Bessel (F-J) transform for estimating multimodal surface wave dispersion curves: synthetic experiments and field applications"/>
<meta name="twitter:description" content="1. Background Passive dense array surface wave tomography plays a significant role in probing the earth&rsquo;s interior with the development of a large number of dense seismic arrays, attracting researchers&rsquo; growing interest in imaging applications in various scales. These array methods, like beamforming and MASW (multichannel analysis of surface wave) have been widely used to estimate dispersion curves in past several decades. A new array stacking technique, the frequency-Bessel (F-J) transform, was proposed about five years ago with some main advantages of extracting dispersion curves of high-resolution and broad frequency band (Wang et al."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Geophydog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/post/home">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/">
        <li class="mobile-menu-item">Blogs</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/tools/">
        <li class="mobile-menu-item">Tools</li>
      </a><a href="/post/about">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Geophydog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/post/home">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/">Blogs</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tools/">Tools</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/about">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">The frequency-Bessel (F-J) transform for estimating multimodal surface wave dispersion curves: synthetic experiments and field applications</h1>

      <div class="post-meta">
        <span class="post-time"> 2024-01-29 </span>
        <div class="post-category">
            <a href="/categories/array-processing/"> array processing </a>
            <a href="/categories/surface-wave/"> surface wave </a>
            <a href="/categories/ambient-noise/"> ambient noise </a>
            <a href="/categories/cross-correlation/"> cross correlation </a>
            <a href="/categories/dispersion-curve/"> dispersion curve </a>
            <a href="/categories/f-j-transform/"> F-J transform </a>
            </div>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-background"><strong>1. Background</strong></a></li>
        <li><a href="#2-principles-of-the-f-j-transform"><strong>2. Principles of the F-J transform</strong></a></li>
        <li><a href="#3-synthetic-experiments-for-extracting-multimodal-dispersion-curves"><strong>3. Synthetic experiments for extracting multimodal dispersion curves</strong></a>
          <ul>
            <li><a href="#31-utilizing-the-cc-fjpy-package-to-estimate-dispersion-curves">3.1 Utilizing the CC-FJpy package to estimate dispersion curves</a></li>
          </ul>
        </li>
        <li><a href="#4-multimodal-dispersion-curves-from-field-ambient-noise"><strong>4. Multimodal dispersion curves from field ambient noise</strong></a>
          <ul>
            <li><a href="#41-field-applications-small-scale-result-from-la-réunion-island">4.1 Field applications: small-scale result from La Réunion Island</a></li>
            <li><a href="#42-field-applications-crustal-and-uppermost-mantle-scale-result-on-the-boundary-of-us-new-mexico-and-texas">4.2 Field applications: crustal and uppermost mantle-scale result on the boundary of US New Mexico and Texas</a></li>
          </ul>
        </li>
        <li><a href="#references"><strong>References</strong></a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-background"><strong>1. Background</strong></h2>
<p>Passive dense array surface wave tomography plays a significant role in probing the earth&rsquo;s interior with
the development of a large number of dense seismic arrays, attracting researchers&rsquo; growing interest in
imaging applications in various scales. These array methods, like beamforming and MASW (multichannel analysis
of surface wave) have been widely used to estimate dispersion curves in past several decades. A new array
stacking technique, the frequency-Bessel (F-J) transform, was proposed about five years ago with some main
advantages of extracting dispersion curves of high-resolution and broad frequency band (Wang et al., 2019).
More importantly, this method facilitates the estimation of multimodal dispersion curves for investimating
underground shear wave velocity structure (Wu et al., 2020; Zhan et al., 2020; Li et al., 2021; Chen et al., 2022;
Ma et al., 2022; Zhang et al., 2022; Xi et al., 2021; Zhou &amp; Chen, 2021; Zhou et al., 2023; Feng et al., 2024;
Chen et al., 2024; Wang et al., 2024; Li et al., 2025; Zhang et al., 2025).
Here we introduce the basic principle of this newly proposed array stacking method.</p>
<h2 id="2-principles-of-the-f-j-transform"><strong>2. Principles of the F-J transform</strong></h2>
<p>The vertical-vertical (Z-Z) component cross-correlations in frequency domain $C_{ZZ}(\omega, r)$ from ambient seismic noise
is approximately proportional to the imaginary part of the Green&rsquo;s function $G_{ZZ}(\omega, r)$ between two receivers with
distance of $r$,
$$
C_{ZZ}(\omega,r) \approx A\cdot Im\{G_{ZZ}(\omega, r)\}, \tag{1}
$$
in which, $\omega$ is angular frequency, and $Im\{\cdot\}$ represents imaginary part. Wang et al (2019) defined
the spectrum $I(\omega, k)$ of the F-J transform as
$$
I(\omega, k)=\int_0^{+\infty}C_{ZZ}(\omega, r)J_0(kr)rdr, \tag{2}
$$
where, $J_0$ is the zeroth-order Bessel function of the first kind. For a flat multi-layered medium, 
$G_{ZZ}(\omega, r)$ due to an isotropic source is expressed as
$$
G_{ZZ}(\omega, r)=\int_0^{+\infty}g_z(\omega, \kappa)J_0(\kappa r)\kappa d\kappa, \tag{3}
$$
where, $g_z(\omega, k)$ is the kernel function of the medium, and it is inversely proportional to the surface wave
dispersion equation, which means that $g_{z}(\omega, \kappa)$ reaches infinity at roots (dispersion curve) of dispersion equation.
Now we use $(1)$, $(2)$ and $(3)$ to obtain
$$
I(\omega, k)=\int_0^{+\infty}Im\{\int_0^{+\infty}g_z(\omega, \kappa)J_0(\kappa r) \kappa d\kappa\}J_0(kr)rdr. \tag{4}
$$
Note the orthogonality of $J_0$, $\int_0^{+\infty}J_0(kr)rdr\int_0^{+\infty}J_0(\kappa r)\kappa d\kappa=\frac{\delta(k-\kappa)}{k}$,
and thus we have
$$
I(\omega, k) \approx A \cdot Im\{g_z(\omega, k)\}. \tag{5}
$$
$(5)$ shows that $I(\omega, k)$ is infinity at the dispersion point. This is the basic idea that we can estimate dispersion curves
utilizing the F-J transform. For F-J dispersion spectrums showing Love and Rayleigh wave dispersion curves from other components: 
Z-R (vertical-Radial), R-Z, T-T (Transverse-Transverse) and R-R (radial-radial), readers can refer to the work by Hu et al. (2020).</p>
<h2 id="3-synthetic-experiments-for-extracting-multimodal-dispersion-curves"><strong>3. Synthetic experiments for extracting multimodal dispersion curves</strong></h2>
<h3 id="31-utilizing-the-cc-fjpy-package-to-estimate-dispersion-curves">3.1 Utilizing the CC-FJpy package to estimate dispersion curves</h3>
<p>There is a convenient Python package named CC-FJpy for extracting dispersion curves developed by members from Xiaofei Chen&rsquo;s team.
We can find this package on this website (<a href="https://github.com/ColinLii/CC-FJpy)">https://github.com/ColinLii/CC-FJpy)</a>. Here we show the dispersion diagram result computed
using this package. Cross-corrrelation functions are from synthetic ambient noise based on the following source-receiver configuration.
<img src="/Surface_Waves/SYN_NOISE_CONFIG.png" alt="noise"></p>
<p>We utilize 100 receivers and 2000 sources to synthesize seismic event. Synthetic ambient noise is generated according to steps
described in <a href="https://geophydog.cool/post/synthetic_ambient_noise/">this blog</a>. Here we show the dispersion diagram using CC-FJpy.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">obspy</span> <span class="kn">import</span> <span class="n">read</span>
<span class="kn">import</span> <span class="nn">ccfj</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="c1"># Match cross-correlation time function files</span>
<span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;ccf/*.SAC&#39;</span><span class="p">))</span>
<span class="c1"># Frequency limitations of dispersion diagram</span>
<span class="n">f1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">f2</span> <span class="o">=</span> <span class="mi">60</span>
<span class="c1"># Half time window width of cross-correlations</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">t1</span> <span class="o">=</span> <span class="o">-</span><span class="n">t0</span><span class="p">;</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">t0</span>
<span class="n">dist</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ccfr</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">ccfi</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">sac</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">sac</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
	<span class="c1"># inster-receiver distance in km is stored in &#34;dist&#34; attribute</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">b</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">delta</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">t1</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">);</span> <span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">t2</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">n1</span><span class="p">:</span> <span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[:</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">ccfr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">ccfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ccfr</span><span class="p">)</span>
<span class="n">nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e3</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

<span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="n">ccfr</span> <span class="o">=</span> <span class="n">ccfr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="c1"># Phase velocity testing range</span>
<span class="n">c1</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">;</span> <span class="n">c2</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">;</span> <span class="n">nc</span> <span class="o">=</span> <span class="mi">501</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">c1</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">c2</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span> <span class="o">/</span> <span class="p">(</span><span class="n">nd</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fn1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f1</span><span class="o">*</span><span class="n">nd</span><span class="o">*</span><span class="n">dt</span><span class="p">);</span> <span class="n">fn2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f2</span><span class="o">*</span><span class="n">nd</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>
<span class="n">nf</span> <span class="o">=</span> <span class="n">fn2</span> <span class="o">-</span> <span class="n">fn1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

<span class="c1"># Compute dispersion diagram using the F-J transform</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ccfj</span><span class="o">.</span><span class="n">fj_noise</span><span class="p">(</span><span class="n">ccfr</span><span class="p">[:,</span> <span class="n">fn1</span><span class="p">:</span> <span class="n">fn2</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span>
                   <span class="n">f</span><span class="p">[</span><span class="n">fn1</span><span class="p">:</span> <span class="n">fn2</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">fstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">func</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1"># Normalization along the frequancy axis</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
    <span class="n">im</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">im</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">fn1</span><span class="p">:</span> <span class="n">fn2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># Load theoretical dispersion curves</span>
<span class="n">dc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;syn-disp.txt&#39;</span><span class="p">)</span>
<span class="n">dc</span> <span class="o">=</span> <span class="n">dc</span><span class="p">[::</span><span class="mi">4</span><span class="p">]</span>
<span class="c1"># Visualize dispersion diagram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">im</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dc</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">dc</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="o">*</span><span class="n">dist</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;w--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Phase velocity (km/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="/Surface_Waves/SYN_DISP.png" alt="disp">
White dots in the above figure are theoretical dispersion curves from the fundamental mode to the third higher mode.</p>
<h2 id="4-multimodal-dispersion-curves-from-field-ambient-noise"><strong>4. Multimodal dispersion curves from field ambient noise</strong></h2>
<h3 id="41-field-applications-small-scale-result-from-la-réunion-island">4.1 Field applications: small-scale result from La Réunion Island</h3>
<p>We collected one-hour (2014-07-05T12:00:00-2014-07-05T13:00:00) continuous seismic waveform data of a seismic arrray composed of 49 short period vertical seismic stations deployed on Piton de la Fournaise volcano (La Réunion Island, Indian Ocean, France) for one month. The aperture size of this seismic array is approximately 750 m with station neighboring spacing of ~ 100 m. The continuous waveform data are from the seismic data center RESIF of France, and one can download these seismic data using the Python package Obspy (Examples of downloading seismic data can de found at: <a href="https://geophydog.cool/post/python_data_processing/">https://geophydog.cool/post/python_data_processing/</a> ). Here is how we request station information about this seismic array: put the link into your browser address bar <code>http://ws.resif.fr/fdsnws/station/1/query?&amp;network=XP&amp;station=B*&amp;channel=DPZ&amp;format=text</code>.
These key parameter settings: <code>network=XP</code>, <code>station=B*</code> and <code>channel=DPZ</code>, can help you find these stations. Push the <code>Enter</code> key and you can get details as below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">#Network|Station|Latitude|Longitude|Elevation|SiteName|StartTime|EndTime
XP|B11|-21.244435|55.682250|2195.1|Piton de la Fournaise, Volcarray antenna B, node 11|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B12|-21.244502|55.683030|2196.1|Piton de la Fournaise, Volcarray antenna B, node 12|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B13|-21.244606|55.683890|2197.6|Piton de la Fournaise, Volcarray antenna B, node 13|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B14|-21.244632|55.684679|2200.6|Piton de la Fournaise, Volcarray antenna B, node 14|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B15|-21.244713|55.685375|2199.4|Piton de la Fournaise, Volcarray antenna B, node 15|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B16|-21.244806|55.686227|2201.1|Piton de la Fournaise, Volcarray antenna B, node 16|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B17|-21.244868|55.687035|2205.7|Piton de la Fournaise, Volcarray antenna B, node 17|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B21|-21.245241|55.682234|2198.9|Piton de la Fournaise, Volcarray antenna B, node 21|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B22|-21.245299|55.683052|2199.0|Piton de la Fournaise, Volcarray antenna B, node 22|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B23|-21.245338|55.683879|2195.8|Piton de la Fournaise, Volcarray antenna B, node 23|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B24|-21.245409|55.684750|2195.1|Piton de la Fournaise, Volcarray antenna B, node 24|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B25|-21.245438|55.685584|2197.6|Piton de la Fournaise, Volcarray antenna B, node 25|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B26|-21.245553|55.686382|2202.8|Piton de la Fournaise, Volcarray antenna B, node 26|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B27|-21.245603|55.687066|2205.8|Piton de la Fournaise, Volcarray antenna B, node 27|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B31|-21.246009|55.682270|2196.8|Piton de la Fournaise, Volcarray antenna B, node 31|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B32|-21.246086|55.683143|2194.9|Piton de la Fournaise, Volcarray antenna B, node 32|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B33|-21.246118|55.683868|2193.9|Piton de la Fournaise, Volcarray antenna B, node 33|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B34|-21.246204|55.684776|2192.3|Piton de la Fournaise, Volcarray antenna B, node 34|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B35|-21.246236|55.685652|2196.5|Piton de la Fournaise, Volcarray antenna B, node 35|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B36|-21.246304|55.686417|2197.5|Piton de la Fournaise, Volcarray antenna B, node 36|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B37|-21.246345|55.687124|2202.8|Piton de la Fournaise, Volcarray antenna B, node 37|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B41|-21.246818|55.682350|2193.6|Piton de la Fournaise, Volcarray antenna B, node 41|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B42|-21.246892|55.683105|2193.2|Piton de la Fournaise, Volcarray antenna B, node 42|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B43|-21.246949|55.683996|2189.7|Piton de la Fournaise, Volcarray antenna B, node 43|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B44|-21.247023|55.684892|2189.9|Piton de la Fournaise, Volcarray antenna B, node 44|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B45|-21.247081|55.685699|2192.3|Piton de la Fournaise, Volcarray antenna B, node 45|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B46|-21.247123|55.686494|2195.5|Piton de la Fournaise, Volcarray antenna B, node 46|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B47|-21.247189|55.687176|2198.9|Piton de la Fournaise, Volcarray antenna B, node 47|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B51|-21.247618|55.682431|2191.5|Piton de la Fournaise, Volcarray antenna B, node 51|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B52|-21.247642|55.683097|2191.4|Piton de la Fournaise, Volcarray antenna B, node 52|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B53|-21.247737|55.684038|2188.8|Piton de la Fournaise, Volcarray antenna B, node 53|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B54|-21.247717|55.684914|2184.6|Piton de la Fournaise, Volcarray antenna B, node 54|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B55|-21.247862|55.685753|2188.2|Piton de la Fournaise, Volcarray antenna B, node 55|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B56|-21.247885|55.686598|2190.4|Piton de la Fournaise, Volcarray antenna B, node 56|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B57|-21.247984|55.687250|2191.9|Piton de la Fournaise, Volcarray antenna B, node 57|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B61|-21.248260|55.682514|2187.3|Piton de la Fournaise, Volcarray antenna B, node 61|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B62|-21.248327|55.683142|2186.3|Piton de la Fournaise, Volcarray antenna B, node 62|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B63|-21.248382|55.683998|2185.0|Piton de la Fournaise, Volcarray antenna B, node 63|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B64|-21.248497|55.685004|2181.1|Piton de la Fournaise, Volcarray antenna B, node 64|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B65|-21.248491|55.685805|2183.6|Piton de la Fournaise, Volcarray antenna B, node 65|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B66|-21.248650|55.686564|2184.9|Piton de la Fournaise, Volcarray antenna B, node 66|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B67|-21.248645|55.687283|2188.6|Piton de la Fournaise, Volcarray antenna B, node 67|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B71|-21.248964|55.682494|2183.6|Piton de la Fournaise, Volcarray antenna B, node 71|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B72|-21.249059|55.683207|2180.3|Piton de la Fournaise, Volcarray antenna B, node 72|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B73|-21.249066|55.684079|2180.8|Piton de la Fournaise, Volcarray antenna B, node 73|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B74|-21.249198|55.685058|2176.3|Piton de la Fournaise, Volcarray antenna B, node 74|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B75|-21.249208|55.685843|2178.9|Piton de la Fournaise, Volcarray antenna B, node 75|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B76|-21.249305|55.686599|2181.2|Piton de la Fournaise, Volcarray antenna B, node 76|2014-07-03T00:00:00|2014-08-01T05:50:00
XP|B77|-21.249316|55.687287|2184.2|Piton de la Fournaise, Volcarray antenna B, node 77|2014-07-03T00:00:00|2014-08-01T05:50:00
</code></pre></td></tr></table>
</div>
</div><p>Save above station information in a text file, say &lsquo;XP.lst&rsquo; for requesting continuous seismic waveform data. We convert geographic longitudes and latitudes into Cartesian coordinates by setting the longtude and latitude of station <code>XP.B11</code> as the origin. The following codes show how we perform the conversion dedails.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">geodesic</span>
<span class="kn">from</span> <span class="nn">obspy.taup.taup_geo</span> <span class="kn">import</span> <span class="n">calc_dist_azi</span> <span class="k">as</span> <span class="n">cda</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">x0</span> <span class="o">=</span> <span class="mf">55.68225</span>
<span class="n">y0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">21.244435</span>
<span class="n">p0</span> <span class="o">=</span> <span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;XP.lst&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">geodesic</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">ellipsoid</span><span class="o">=</span><span class="s1">&#39;WGS-84&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">km</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cda</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">6371</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">az</span> <span class="o">=</span> <span class="n">az</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">az</span><span class="p">)</span> <span class="o">*</span> <span class="n">dist</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">az</span><span class="p">)</span> <span class="o">*</span> <span class="n">dist</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">%f</span><span class="s1"> </span><span class="si">%f</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;xy.lst&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
    <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>The relative Cartesian coordinates of all stations are save in file <code>xy.lst</code> that contains four columns: <code>network.station</code>, <code>easting (km)</code>, <code>northing (km)</code> and <code>elevation (m)</code>.
<img src="/Surface_Waves/XP_B_map.jpg" alt="array"></p>
<p>Here we give the python codes for retirving seismic data from <code>RESIF</code> data center:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">obspy.clients.fdsn.client</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">obspy.core</span> <span class="kn">import</span> <span class="n">UTCDateTime</span><span class="p">,</span> <span class="n">Stream</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s1">&#39;RESIF&#39;</span><span class="p">)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="s1">&#39;2014-07-05T12:00:00&#39;</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="s1">&#39;2014-07-05T13:00:00&#39;</span><span class="p">)</span>
<span class="n">sta</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;XP.lst&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">tmp</span> <span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
        <span class="n">sta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
<span class="n">seg</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">3600</span>
<span class="n">ch</span> <span class="o">=</span> <span class="s1">&#39;DPZ&#39;</span>
<span class="k">print</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">t1</span>
<span class="k">while</span> <span class="n">tt</span> <span class="o">&lt;</span> <span class="n">t2</span><span class="p">:</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/&#39;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dirname</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%02d</span><span class="s1">_&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">sta</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">dirname</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">hour</span><span class="o">+</span><span class="n">ns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">ns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;*.SAC&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="n">network</span><span class="o">=</span><span class="n">ns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">station</span><span class="o">=</span><span class="n">ns</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">channel</span><span class="o">=</span><span class="n">ch</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
                                  <span class="n">starttime</span><span class="o">=</span><span class="n">tt</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="n">tt</span><span class="o">+</span><span class="n">seg</span><span class="p">)</span>
            <span class="n">stc</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">st</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">tr</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="o">-</span><span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">+</span> <span class="n">tr</span><span class="o">.</span><span class="n">data</span>
                <span class="n">tr</span><span class="o">.</span><span class="n">detrend</span><span class="p">()</span>
                <span class="n">tr</span><span class="o">.</span><span class="n">taper</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
                <span class="n">stc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
            <span class="n">stc</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">stc</span><span class="p">:</span>
                <span class="n">sac</span> <span class="o">=</span> <span class="n">dirname</span> <span class="o">+</span> <span class="n">hour</span><span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                                           <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span><span class="p">,</span>
                                           <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span>
                                           <span class="s1">&#39;SAC&#39;</span><span class="p">])</span>
                <span class="n">tr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sac</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;SAC&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;No data of&#39;</span><span class="p">,</span> <span class="n">ns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ns</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">tt</span> <span class="o">+=</span> <span class="n">seg</span>
</code></pre></td></tr></table>
</div>
</div><p>Two-minute raw data segments were splitted for performing pre-processing (removing mean, trend and tapering, normalization in time domain and spectral whitening), and computing cross-correlation functions (CCFs) with an overlap ratio of 50% (one minute). Here we show CCFs (waveforms on the frequency band of 0.5&ndash;15 Hz) between station XP.B11 and the other stations. These processing steps follow the details by Bense net al. (2007), generating CCFs of whole station-pairs:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span><span class="lnt">97
</span><span class="lnt">98
</span><span class="lnt">99
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">obspy</span> <span class="kn">import</span> <span class="n">read</span><span class="p">,</span> <span class="n">UTCDateTime</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ones</span><span class="p">,</span> <span class="n">convolve</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">obspy.core</span> <span class="kn">import</span> <span class="n">Trace</span><span class="p">,</span> <span class="n">AttribDict</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">hilbert</span><span class="p">,</span> <span class="n">sosfilt</span><span class="p">,</span> <span class="n">zpk2sos</span><span class="p">,</span> <span class="n">sosfilt</span><span class="p">,</span> <span class="n">iirfilter</span>
<span class="kn">from</span> <span class="nn">scipy.signal.windows</span> <span class="kn">import</span> <span class="n">hann</span>

<span class="k">def</span> <span class="nf">process_trace</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">nfft</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">p</span><span class="p">);</span> <span class="n">hn</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sn</span><span class="p">;</span> <span class="n">h</span> <span class="o">=</span> <span class="n">hann</span><span class="p">(</span><span class="n">hn</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[:</span><span class="n">sn</span><span class="p">]</span> <span class="o">*=</span> <span class="n">h</span><span class="p">[:</span><span class="n">sn</span><span class="p">];</span> <span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="n">sn</span><span class="p">:]</span> <span class="o">*=</span> <span class="n">h</span><span class="p">[</span><span class="o">-</span><span class="n">sn</span><span class="p">:]</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">nfft</span><span class="p">)</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">fd</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">fd</span><span class="p">),</span> <span class="n">operator</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
    <span class="n">fd</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">fd</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">fd</span>

<span class="n">sta</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;xy.lst&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fin</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">sta</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">dd</span><span class="p">)</span> <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span> <span class="mi">3</span><span class="p">]]</span>
<span class="n">f1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="n">f2</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.004</span><span class="p">;</span> <span class="n">fs</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">dt</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">h</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">operator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">segt</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">60</span>
<span class="n">ot</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span> <span class="n">pt</span> <span class="o">=</span> <span class="n">segt</span> <span class="o">-</span> <span class="n">ot</span>
<span class="n">segn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">segt</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>
<span class="n">pn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">segt</span><span class="o">-</span><span class="n">ot</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>
<span class="n">nfft</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">segt</span><span class="o">*</span><span class="mf">0.55</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nfft</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">-</span> <span class="n">nfft</span><span class="o">//</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span>
<span class="n">t1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">60</span><span class="p">;</span> <span class="n">t2</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">tn1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">t1</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="n">dt</span><span class="p">);</span> <span class="n">tn2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">t2</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">tn1</span><span class="p">:</span> <span class="n">tn2</span><span class="p">]</span>
<span class="n">cor</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">cor</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="n">dt</span>
<span class="n">cor</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span> <span class="o">=</span> <span class="n">AttribDict</span><span class="p">({})</span>
<span class="n">cor</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cor</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nfft</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;2014-07-05&#39;</span>
<span class="n">hour</span> <span class="o">=</span> <span class="mi">12</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Read data ...&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">date</span><span class="o">+</span><span class="s1">&#39;/</span><span class="si">%02d</span><span class="s1">_XP.B*Z.SAC&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hour</span><span class="p">))</span>
    <span class="n">lm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lm</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;No enough data!!!&#39;</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="n">ccfdir</span> <span class="o">=</span> <span class="s1">&#39;CCF_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%02d</span><span class="s1">/&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ccfdir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">ccfdir</span><span class="p">)</span>
<span class="n">utc1</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
<span class="n">utc2</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span>
<span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">st</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">&lt;</span> <span class="n">utc1</span><span class="p">:</span>
        <span class="n">utc1</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>
    <span class="k">if</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span> <span class="o">&gt;</span> <span class="n">utc2</span><span class="p">:</span>
        <span class="n">utc2</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">endtime</span>
<span class="n">ln</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">utc2</span><span class="o">-</span><span class="n">utc1</span><span class="o">+</span><span class="n">segt</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Store data ...&#39;</span><span class="p">)</span>
<span class="n">ns</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">all_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">lm</span><span class="p">,</span> <span class="n">ln</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lm</span><span class="p">):</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span><span class="o">-</span><span class="n">utc1</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">all_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">n1</span><span class="p">:</span> <span class="n">n1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">ns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">network</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">st</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Preprocess data ...&#39;</span><span class="p">)</span>
<span class="n">data_fd</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lm</span><span class="p">):</span>
    <span class="n">dn1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">dn1</span> <span class="o">&lt;=</span> <span class="n">ln</span><span class="o">-</span><span class="n">segn</span><span class="p">:</span>
        <span class="n">dn2</span> <span class="o">=</span> <span class="n">dn1</span> <span class="o">+</span> <span class="n">segn</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">process_trace</span><span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">dn1</span><span class="p">:</span> <span class="n">dn2</span><span class="p">],</span> <span class="n">nfft</span><span class="p">,</span> <span class="n">operator</span><span class="p">)</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="n">dn1</span> <span class="o">+=</span> <span class="n">pn</span>
    <span class="n">data_fd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;CCF ...&#39;</span><span class="p">)</span>
<span class="n">nstack</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_fd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lm</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">sta</span><span class="p">[</span><span class="n">ns</span><span class="p">[</span><span class="n">si</span><span class="p">]][:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">sj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">si</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">lm</span><span class="p">):</span>
        <span class="n">xj</span><span class="p">,</span> <span class="n">yj</span> <span class="o">=</span> <span class="n">sta</span><span class="p">[</span><span class="n">ns</span><span class="p">[</span><span class="n">sj</span><span class="p">]][:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ccfname</span> <span class="o">=</span> <span class="s1">&#39;COR_&#39;</span> <span class="o">+</span> <span class="n">ns</span><span class="p">[</span><span class="n">si</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">ns</span><span class="p">[</span><span class="n">sj</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.SAC&#39;</span>
        <span class="n">ccfd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nfft</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">xi</span><span class="o">-</span><span class="n">xj</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yi</span><span class="o">-</span><span class="n">yj</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">cor</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span>
        <span class="k">for</span> <span class="n">sk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nstack</span><span class="p">):</span>
            <span class="n">ccfd</span> <span class="o">+=</span> <span class="p">(</span><span class="n">data_fd</span><span class="p">[</span><span class="n">si</span><span class="p">][</span><span class="n">sk</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">data_fd</span><span class="p">[</span><span class="n">sj</span><span class="p">][</span><span class="n">sk</span><span class="p">]))</span>
        <span class="n">cor</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">ccfd</span><span class="p">))</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">tn1</span><span class="p">:</span> <span class="n">tn2</span><span class="p">]</span>
        <span class="n">cor</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">evlo</span> <span class="o">=</span> <span class="n">xi</span><span class="p">;</span> <span class="n">cor</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">evla</span> <span class="o">=</span> <span class="n">yi</span>
        <span class="n">cor</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">stlo</span> <span class="o">=</span> <span class="n">xj</span><span class="p">;</span> <span class="n">cor</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">stla</span> <span class="o">=</span> <span class="n">yj</span>
        <span class="n">cor</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s1">&#39;bandpass&#39;</span><span class="p">,</span> <span class="n">freqmin</span><span class="o">=</span><span class="n">f1</span><span class="p">,</span> <span class="n">freqmax</span><span class="o">=</span><span class="n">f2</span><span class="p">,</span> <span class="n">corners</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">zerophase</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">cor</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ccfdir</span><span class="o">+</span><span class="n">ccfname</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="/Surface_Waves/XP_B_ccf.jpg" alt="CCF"></p>
<p>Now we compute the Rayleigh wave dispersion diagram using the F-J transform from CCFs of the all station-pairs in this whole array. Two surface wave modes emerge from the F-J dspectrum, showing the fundamental-mode and the first higher-mode dispersion curves. Tip: the F-J dispersion diagram can be obtained utilizing the CC-FJpy Python package ( <a href="https://github.com/ColinLii/CC-FJpy">https://github.com/ColinLii/CC-FJpy</a> ).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">obspy</span> <span class="kn">import</span> <span class="n">read</span>
<span class="kn">import</span> <span class="nn">ccfj</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">ccf_dir</span> <span class="o">=</span> <span class="s1">&#39;CCF_2014-07-05_12&#39;</span>
<span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;XP.B*&#39;</span>
<span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">ccf_dir</span><span class="o">+</span><span class="s1">&#39;/COR_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.SAC&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">)))</span>
<span class="n">f1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">f2</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span> <span class="n">t1</span> <span class="o">=</span> <span class="o">-</span><span class="n">t0</span><span class="p">;</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">t0</span>
<span class="n">dist</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">ccfr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">sac</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">tr</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">sac</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">evla</span><span class="p">;</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">evlo</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">stla</span><span class="p">;</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">stlo</span>
    <span class="n">gcarc</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y1</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="mf">1e3</span>
    <span class="k">if</span> <span class="n">gcarc</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gcarc</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">sac</span><span class="o">.</span><span class="n">b</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">delta</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">t1</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">);</span> <span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">t2</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">n1</span><span class="p">:</span> <span class="n">n2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="n">ccfr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">real</span><span class="p">[:</span><span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;CCF files:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
<span class="n">ccfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ccfr</span><span class="p">)</span>
<span class="n">nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="n">ccfr</span> <span class="o">=</span> <span class="n">ccfr</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;rmin: </span><span class="si">%.6f</span><span class="s1"> m rmax: </span><span class="si">%.6f</span><span class="s1"> m&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">dist</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
<span class="n">c1</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span> <span class="n">c2</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span> <span class="n">nc</span> <span class="o">=</span> <span class="mi">301</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">/</span> <span class="n">dt</span> <span class="o">/</span> <span class="p">(</span><span class="n">nd</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fn1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f1</span><span class="o">*</span><span class="n">nd</span><span class="o">*</span><span class="n">dt</span><span class="p">);</span> <span class="n">fn2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f2</span><span class="o">*</span><span class="n">nd</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>
<span class="n">nf</span> <span class="o">=</span> <span class="n">fn2</span> <span class="o">-</span> <span class="n">fn1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ccfj</span><span class="o">.</span><span class="n">fj_noise</span><span class="p">(</span><span class="n">ccfr</span><span class="p">[:,</span> <span class="n">fn1</span><span class="p">:</span> <span class="n">fn2</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">dist</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span>
                   <span class="n">f</span><span class="p">[</span><span class="n">fn1</span><span class="p">:</span> <span class="n">fn2</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">fstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">func</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">im</span><span class="p">[</span><span class="n">im</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
    <span class="k">if</span> <span class="n">im</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">im</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">im</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">**</span><span class="mi">2</span>

<span class="n">arrowprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span>
    <span class="n">connectionstyle</span><span class="o">=</span><span class="s1">&#39;angle,angleA=90,angleB=0,rad=10&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00BFFF&#39;</span><span class="p">)</span>
<span class="n">bbox</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00BFFF&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.98</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.12</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">fj</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma_r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;fundamental mode&#39;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">520</span><span class="p">),</span>
            <span class="n">arrowprops</span><span class="o">=</span><span class="n">arrowprops</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;1$^{st}$ higher mode&#39;</span><span class="p">,</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1200</span><span class="p">),</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span>
            <span class="n">arrowprops</span><span class="o">=</span><span class="n">arrowprops</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Phase velocity (m/s)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="/Surface_Waves/fj_XP_B_2014-07-05T12.jpg" alt="DISP"></p>
<h3 id="42-field-applications-crustal-and-uppermost-mantle-scale-result-on-the-boundary-of-us-new-mexico-and-texas">4.2 Field applications: crustal and uppermost mantle-scale result on the boundary of US New Mexico and Texas</h3>
<h2 id="references"><strong>References</strong></h2>
<p>Bensen, G.D., Ritzwoller, M.H., Barmin, M.P., Levshin, A.L., Lin, F., Moschetti, M.P., Shapiro, N.M. and Yang, Y. (2007), Processing seismic ambient noise data to obtain reliable broad-band surface wave dispersion measurements. Geophysical Journal International, 169: 1239-1260.</p>
<p>Chen, J., Pan, L., Li, Z., &amp; Chen, X. (2022). Continental reworking in the eastern South China Block and its adjacent areas revealed by F-J multimodal ambient noise tomography. Journal of Geophysical Research: Solid Earth, 127, e2022JB024776.</p>
<p>Chen, J., Li, Z., &amp; Chen, X. (2024). A mid-crustal channel of positive radial anisotropy beneath the eastern South China Block from F-J multimodal ambient noise tomography. Geophysical Research Letters, 51, e2024GL110766.</p>
<p>Feng, X., Xia, Y. &amp; Chen, X. (2024). Frequency-Bessel multi-mode surface wave tomography utilizing microseisms excited by energetic typhoons. Sci. China Earth Sci. 67, 3436–3447.</p>
<p>Hu, S., Luo, S., &amp; Yao, H. (2020). The Frequency-Bessel Spectrograms of multicomponent cross-correlation functions from seismic ambient noise. Journal of Geophysical Research: Solid Earth, 125, e2020JB019630.</p>
<p>Li Haiyan, Juqing Chen, Zhengbo Li, Xiaofei Chen, Huiteng Cai, Xuping Feng, Gongheng Zhang, Zhen Jin. (2025). Mid-crustal low-velocity zones beneath Southeastern Coastal China revealed by multimodal ambient noise tomography: Insights into Mesozoic magmatic activities. Tectonophysics, 898, 230636.</p>
<p>Li Z., Jie Zhou, Gaoxiong Wu, Jiannan Wang, Gongheng Zhang, Sheng Dong, Lei Pan, Zhentao Yang, Lina Gao, Qingbo Ma, Hengxin Ren, Xiaofei Chen; CC‐FJpy: A Python Package for Extracting Overtone Surface‐Wave Dispersion from Seismic Ambient‐Noise Cross Correlation. Seismological Research Letters 2021;; 92 (5): 3179–3186.</p>
<p>Ma Q, Pan L, Wang J-, Yang Z and Chen X (2022) Crustal S-Wave Velocity Structure Beneath the Northwestern Bohemian Massif, Central Europe, Revealed by the Inversion of Multimodal Ambient Noise Dispersion Curves. Front. Earth Sci. 10:838751.</p>
<p>Pan Lei, Xiaofei Chen, Jiannan Wang, Zhentao Yang, Dazhou Zhang, Sensitivity analysis of dispersion curves of Rayleigh waves with fundamental and higher modes, Geophysical Journal International, Volume 216, Issue 2, February 2019, Pages 1276–1303</p>
<p>Wang, J., Wu, G., &amp; Chen, X. (2019). Frequency‐Bessel transform method for effective imaging of higher‐mode Rayleigh dispersion curves from ambient seismic noise data. Journal of Geophysical Research: Solid Earth, 124(4), 3708-3723.</p>
<p>Wang P., Chen J., Feng X., Pan L., &amp; Chen X. (2024) Crust and upper mantle S wave velocity structure in eastern Turkey based on ambient noise tomography. Tectonophysics,876, 230267.</p>
<p>Wu, G.-x., Pan, L., Wang, J.-n., &amp; Chen, X. (2020). Shear velocity inversion using multimodal dispersion curves from ambient seismic noise data of USArray transportable array. Journal of Geophysical Research: Solid Earth, 125, e2019JB018213.</p>
<p>Xi Chaoqiang, Jianghai Xia, Binbin Mi, Tianyu Dai, Ya Liu, Ling Ning. (2021). Modified frequency–Bessel transform method for dispersion imaging of Rayleigh waves from ambient seismic noise. Geophysical Journal International, 255(2), 1271–1280.</p>
<p>Zhan Wang, Lei Pan, Xiaofei Chen. (2020) A widespread mid-crustal low-velocity layer beneath Northeast China revealed by the multimodal inversion of Rayleigh waves from ambient seismic noise. Journal of Asian Earth Sciences, 196, 104372.</p>
<p>Zhang S, Zhang G, Feng X, Li Z, Pan L, Wang J and Chen X. (2022). A crustal LVZ in Iceland revealed by ambient noise multimodal surface wave tomography. Front. Earth Sci. 10:1008354.</p>
<p>Zhang Sen, Juqing Chen, Lei Pan, Zhengbo Li, Xiaofei Chen. (2024). Seismic structure of Iceland revealed by ambient noise Rayleigh wave tomography. Tectonophysics, 891, 230511.</p>
<p>Zhang, Yanyan &amp; Chen, Xiaofei &amp; Chen, Juqing &amp; Zhang, Gongheng &amp; Li, Zhengbo &amp; Pan, Lei &amp; Wang, Jiannan &amp; Ding, Zhifeng &amp; Wang, Xingchen &amp; Yuan, Songyong. (2025). Seismic evidence of subduction during the assembly of the North China Craton from multimodal dispersion inversion. Tectonophysics. 904. 230715.</p>
<p>Zhou Jie, &amp; Chen Xiaofei. (2021) Removal of Crossed Artifacts from Multimodal Dispersion Curves with Modified Frequency–Bessel Method. Bulletin of the Seismological Society of America, 112 (1): 143–152.</p>
<p>Zhou, J., Li, Z., &amp; Chen, X. (2023). Extending the frequency band of surface-wave dispersion curves by combining ambient noise and earthquake data and self-adaptive normalization. Journal of Geophysical Research: Solid Earth, 128, e2022JB026040.</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Geophydog</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2024-01-29
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/surface-wave/">surface wave</a>
          <a href="/tags/array-processing/">array processing</a>
          <a href="/tags/dispersion-curve/">dispersion curve</a>
          <a href="/tags/frequency-bessel-transform/">frequency-Bessel transform</a>
          <a href="/tags/f-j/">F-J</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/synthetic_ambient_noise/">
            <span class="next-text nav-default">Synthetic ambient noise and noise cross-correlations</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:geophydogvon@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/geophydog" class="iconfont icon-github" title="github"></a>
  <a href="https://geophydog.cool/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2020 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span>Geophydog All rights reserved</span>
  </span>
</div>


    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
